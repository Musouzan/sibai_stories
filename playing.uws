// Declared In main.uws
// PUBLIC PREVIOUS_TIME

CALL lib.uws

IF PARAM_STR[0] = EMPTY OR !CHKNUM(PARAM_STR[1]) THEN EXITEXIT
CONFIG_FILE = PARAM_STR[0]
WARRIOR_IS_RESTING = PARAM_STR[1]

IMG_ELEMENT = READINIWITHOUTCOMMENT("Images", "ElementTab", CONFIG_FILE)
IMG_FINISH = "./img/finish.bmp"
IMG_START = "./img/start.bmp"
IMG_TAB_ACTIVATED = READINIWITHOUTCOMMENT("Images", "TabActivated", CONFIG_FILE)
IMG_TAB_ACTIVATED_RESTING = READINIWITHOUTCOMMENT("Images", "TabActivatedResting", CONFIG_FILE)
IMG_WARRIOR_LIST_GET_READY = "./img/wind.bmp"

ELEMENT_TAB_X = READINIWITHOUTCOMMENT("Points", "ElementTabX", CONFIG_FILE)
ELEMENT_TAB_Y = READINIWITHOUTCOMMENT("Points", "ElementTabY", CONFIG_FILE)
RESTING_WARRIOR_X = READINIWITHOUTCOMMENT("Points", "RestingWarriorX", CONFIG_FILE)
RESTING_WARRIOR_Y = READINIWITHOUTCOMMENT("Points", "RestingWarriorY", CONFIG_FILE)
TARGET_AREA_X = READINIWITHOUTCOMMENT("Points", "TargetAreaY", CONFIG_FILE)
TARGET_AREA_Y = READINIWITHOUTCOMMENT("Points", "TargetAreaY", CONFIG_FILE)
WARRIOR_X = READINIWITHOUTCOMMENT("Points", "WarriorX", CONFIG_FILE)
WARRIOR_Y = READINIWITHOUTCOMMENT("Points", "WarriorY", CONFIG_FILE)

DELAY_BEFORE_CLICKING_AREA = READINIWITHOUTCOMMENT("Intervals", "BeforeClickingArea", CONFIG_FILE)
DELAY_BEFORE_STARTING_PLANNING_PARTY = READINIWITHOUTCOMMENT("Intervals", "BeforeStartingPlanningParty", CONFIG_FILE)
DELAY_BEFORE_CLICKING_ELEMENT_TAB = READINIWITHOUTCOMMENT("Intervals", "BeforeClickingElementTab", CONFIG_FILE)
DELAY_BEFORE_CLICKING_WARRIOR = READINIWITHOUTCOMMENT("Intervals", "BeforeClickingWarrior", CONFIG_FILE)
DELAY_BEFORE_DECIDING_TO_REVIVE = READINIWITHOUTCOMMENT("Intervals", "BeforeDecidingToRevive", CONFIG_FILE)
DELAY_AFTER_REVIVING = READINIWITHOUTCOMMENT("Intervals", "AfterReviving", CONFIG_FILE)
DELAY_BEFORE_FINISHING_PLANNING_PARTY = READINIWITHOUTCOMMENT("Intervals", "BeforeFinishingPlanningParty", CONFIG_FILE)
DELAY_BEFORE_STARTING_BATTLES = READINIWITHOUTCOMMENT("Intervals", "BeforeStartingBattles", CONFIG_FILE)
DELAY_BEFORE_FINISHING_BATTLES = READINIWITHOUTCOMMENT("Intervals", "BeforeFinishingBattles", CONFIG_FILE)

CHECK_IMG_TICK = READINIWITHOUTCOMMENT("Intervals", "CheckImageTick", CONFIG_FILE)

// Click The Area
WAITIMG(IMG_START, CHECK_IMG_TICK)
SLEEP(DELAY_BEFORE_CLICKING_AREA)
BTN(LEFT, CLICK, TARGET_AREA_X, TARGET_AREA_Y)

// Click Button(StartPlanningParty)
SLEEP(DELAY_BEFORE_STARTING_PLANNING_PARTY)
BTN(LEFT, CLICK, 765, 412)

// Click Tab(SpecificElement)
WAITIMG(IMG_ELEMENT, CHECK_IMG_TICK)
SLEEP(DELAY_BEFORE_CLICKING_ELEMENT_TAB)
BTN(LEFT, CLICK, ELEMENT_TAB_X, ELEMENT_TAB_Y)

WHILE TRUE
  IFB WARRIOR_IS_RESTING AND GETTIME() MOD 86400 > PREVIOUS_START_TIME MOD 86400
    // Click The Warrior
    WAITIMG(IMG_TAB_ACTIVATED_RESTING, CHECK_IMG_TICK)  
    SLEEP(DELAY_BEFORE_CLICKING_WARRIOR)
    IF GETTIME() MOD 86400 < PREVIOUS_START_TIME MOD 86400 THEN BREAK
    BTN(LEFT, CLICK, RESTING_WARRIOR_X, RESTING_WARRIOR_Y)

    // Click Button(DecideToRevive)
    WAITVANISHINGIMG(IMG_TAB_ACTIVATED, CHECK_IMG_TICK)
    SLEEP(DELAY_BEFORE_DECIDING_TO_REVIVE)
    BTN(LEFT, CLICK, 397, 365)
  ENDIF
  BREAK
WEND

// Click The Warrior
WAITIMG(IMG_TAB_ACTIVATED, CHECK_IMG_TICK)
SLEEP(DELAY_BEFORE_CLICKING_WARRIOR + WARRIOR_IS_RESTING * DELAY_AFTER_REVIVING)
BTN(LEFT, CLICK, WARRIOR_X, WARRIOR_Y)
PREVIOUS_START_TIME = GETTIME()

// Click Button(FinishPlanningParty)
SLEEP(DELAY_BEFORE_FINISHING_PLANNING_PARTY)
KBD(VK_ESC)

// Click Button(StartBattles)
WAITIMG(IMG_START, CHECK_IMG_TICK)
SLEEP(DELAY_BEFORE_STARTING_BATTLES)
BTN(LEFT, CLICK, 675, 470)

// Click Button(FinishBattles)
WAITIMG(IMG_FINISH, CHECK_IMG_TICK)
SLEEP(DELAY_BEFORE_FINISHING_BATTLES)
BTN(LEFT, CLICK, 675, 470)